## Инструменты для разработки

В прошлой главе мы работали с Bash в интерактивном режиме. Порядок работы в этом режиме выглядит так:

1. Вы вводите команду в окне эмулятора терминал.
2. Процесс Bash получает команду и сохраняет её в оперативную память.
3. Bash исполняет команду и передаёт терминалу её вывод.
4. Bash удаляет команду из оперативной памяти.

Оперативная память не подходит для хранения программы. Она предназначена для временного хранения информации. Память очищается каждый раз, когда вы выключаете компьютер.

Если вы написали программу, её надо сохранить на жёстком диске. Диск предназначен для длительного хранения информации.

Чтобы создать или отредактировать файлы с исходным кодом, вам нужна специальная программа. Она называется [редактор исходного кода](https://ru.wikipedia.org/wiki/Редактор_исходного_кода).

Рассмотрим, какие редакторы подходят для работы с Bash.

### Редактор исходного кода

Писать Bash-скрипты можно в любом текстовом редакторе. Для этого подойдёт даже стандартное приложение Windows под названием [Блокнот](https://ru.wikipedia.org/wiki/Блокнот_(программа)) (Notepad). Но работать с ним будет неудобно. У Блокнота нет дополнительных возможностей для редактирования исходного кода. Эти возможности значительно ускорят вашу работу.

Сегодня в интернете доступно много редакторов исходного кода. Некоторые из них распространяются бесплатно, а некоторые требуют лицензии. Чтобы выбрать подходящий вам редактор, попробуйте несколько вариантов.

Мы рассмотрим три популярных редактора исходного кода. Для начала попробуйте поработать с одним из них.

W> Обратите внимание, что офисный пакет MS Office и его открытый аналог [LibreOffice](https://ru.wikipedia.org/wiki/LibreOffice) не подходят для написания кода. Они сохраняют файлы в бинарных или [XML-подобных](https://ru.wikipedia.org/wiki/XML) форматах. Интерпретаторы и компиляторы не смогут их прочитать. На входе они ожидают текстовые файлы. Именно в таком формате сохраняют файлы редакторы исходного кода.

[**Notepad++**](https://ru.wikipedia.org/wiki/Notepad++#cite_note-8) — это быстрый и минималистичный редактор с открытым исходным кодом. Он запускается только на ОС Windows. Поэтому для macOS или Linux, лучше рассмотреть другие варианты. Последнюю версию Notepad++ можно загрузить с [официального сайта](https://notepad-plus-plus.org/downloads/).

[**Sublime Text**](https://ru.wikipedia.org/wiki/Sublime_Text#cite_note-Features-4) — это проприетарный [**кроссплатформенный**](https://ru.wikipedia.org/wiki/Кроссплатформенность) редактор. Кроссплатформенность означает, что программа запускается на разных ОС и [**аппаратных платформах**](https://ru.wikipedia.org/wiki/Аппаратная_платформа_компьютера). Sublime Text можно использовать бесплатно без активации и лицензии. Но в этом режиме редактор регулярно выводит диалоговое окно с предложением купить лицензию. Загрузить программу можно с [официального сайта](https://www.sublimetext.com/).

[*Visual Studio Code*](https://ru.wikipedia.org/wiki/Visual_Studio_Code) — это кроссплатформенный редактор от компании Microsoft с открытым исходным кодом. Он работает на Windows, Linux и macOS. Для работы с ним лицензия не нужна. Редактор можно загрузить с [официального сайта](https://code.visualstudio.com/).

Для работы с исходным кодом у всех трёх редакторов есть следующие возможности:

* [Подсветка синтаксиса](https://ru.wikipedia.org/wiki/Подсветка_синтаксиса).
* [Автодополнение](https://ru.wikipedia.org/wiki/Автодополнение).
* Поддержка широко распространённых [кодировок символов](https://ru.wikipedia.org/wiki/Набор_символов).

Редактировать исходный код можно и без этих возможностей. Но они ускоряют работу, облегчают редактирование программы и поиск ошибок в ней. Кроме того они помогут вам быстрее освоиться с синтаксисом Bash.

### Запуск редактора

Есть несколько способов запустить редактор исходного кода. Первый вариант — через графический интерфейс ОС. В случае Windows, используйте иконку программы на рабочем столе или в меню Пуск. Скорее всего, так вы запускаете все программы на вашем компьютере.

Второй вариант — запустить редактор из командной оболочки. Этот способ удобнее в некоторых случаях. Например, когда вы ищете файлы с помощью утилиты find. Результаты поиска можно передать на вход редактору. Он откроет все найденные файлы в разных вкладках. Такой приём работает, потому что все современные редакторы имеют интерфейс командной строки.

Запустить приложение из Bash можно тремя способами:

1. По имени исполняемого файла.
2. По абсолютному пути.
3. По относительному пути.

Первый способ самый удобный. Чтобы он заработал, добавьте каталог установки приложения в переменную Bash под названием `PATH`. Тогда интерпретатор сможет найти и запустить исполняемый файл программы.

Для примера запустим редактор Notepad++ по имени исполняемого файла. Путь установки редактора по умолчанию следующий:
{line-numbers: false}
```
C:\Program Files (86)\Notepad++
```

I> Если вы не знаете путь установки редактора, прочитайте его в свойствах ярлыка Notepad++ на рабочем столе или в меню Пуск.

В окружении MSYS2 тот же путь установки редактора выглядит так:
{line-numbers: false}
```
/c/Program Files (x86)/Notepad++
```

Если запустить Notepad++ по этому абсолютному пути, Bash сообщит об ошибке. Она показана на иллюстрации 3-1.

{caption: "Иллюстрация 3-1. Результат запуска Notepad++"}
![Результат запуска Notepad++](images/BashScripting/notepad-error.png)

У команды на иллюстрации 3-1 есть несколько проблем. Рассмотрим их по порядку. Команда cd может дать подсказку о первой проблеме. Вызовем cd так:
{line-numbers: false, format: Bash}
```
cd /c/Program Files
```

Результат команды приведён на иллюстрации 3-2.

{caption: "Иллюстрация 3-2. Результат выполнения cd"}
![Результат cd](images/BashScripting/cd-many-arguments.png)

Bash сообщает следующее: команда cd получила больше параметров, чем ей нужно. Она ожидает на вход только один параметр — путь к целевому каталогу. В нашем случае передано два параметра.

Ошибка возникла из-за механизма Bash под названием **word splitting**. Он разделяет пробелом путь к редактору Notepad++ на две части. Таким образом в команду cd передаются два пути: `/c/Program` и `Files`.

Есть два способа отключить механизм word splitting:

1. Заключить путь в двойные кавычки:
{line-numbers: false, format: Bash}
```
cd "/c/Program Files"
```

2. Экранировать все пробелы с помощью обратного слэша:
{line-numbers: false, format: Bash}
```
cd /c/Program\ Files
```

После отключения word splitting, Bash правильно исполнит команду cd.

Теперь вызовем команду cd, чтобы перейти по пути `/c/Program Files (x86)`. Такой вариант не сработает:
{line-numbers: false, format: Bash}
```
cd /c/Program Files (x86)
```

Мы выяснили, что Bash разделяет входной параметр на части. Отключим word splitting с помощью обратного слэша. Получим следующую команду:
{line-numbers: false, format: Bash}
```
cd /c/Program\ Files\ (x86)
```

Эта команда завершится с ошибкой, как на иллюстрации 3-3.

{caption: "Иллюстрация 3-3. Результат выполнения cd"}
![Результат cd](images/BashScripting/cd-unexpected-token.png)

Точно такую же ошибку вывел Bash на иллюстрации 3-1, когда мы запускали Notepad++. Проблема в том, что кавычки ( и ) являются частью синтаксиса Bash. Поэтому интерпретатор обрабатывает их как конструкцию языка. Мы уже сталкивались с этой проблемой, когда группировали выражения утилиты find. Экранирование обратным слэшем или двойные кавычки решат эту проблему. Например, так:
{line-numbers: true, format: Bash}
```
cd /c/Program\ Files\ \(x86\)
cd "/c/Program Files (x86)"
```

Применим кавычки и получим следующую команду для запуска Notepad++ по абсолютному пути:
{line-numbers: false, format: Bash}
```
"/c/Program Files (x86)/Notepad++/notepad++.exe"
```

Теперь Bash запустит редактор.

Каждый раз набирать полный путь установки редактора неудобно. Было бы лучше запускать Notepad++ по имени исполняемого файла. Чтобы этот способ заработал, добавьте путь установки редактора в переменную `PATH`. Для этого в конец файла `~/.bash_profile` добавьте следующую строку:
{line-numbers: false, format: Bash}
```
PATH="/c/Program Files (x86)/Notepad++:${PATH}"
```

Перезапустите терминал MSYS2. Теперь Notepad++ запускается следующей командой:
{line-numbers: false, format: Bash}
```
notepad++.exe
```

Вместо редактирования переменной `PATH` можно использовать **псевдонимом** (alias). Этот механизм Bash заменяет введённую вами команду на другую. Таким образом можно сократить набор длинных строк.

У нас есть следующая команда для запуска Notepad++:
{line-numbers: false, format: Bash}
```
"/c/Program Files (x86)/Notepad++/notepad++.exe"
```

Объявим для неё псевдоним `notepad++`. Для этого вызовем Bash-команду alias так:
{line-numbers: false, format: Bash}
```
alias notepad++="/c/Program\ Files\ \(x86\)/Notepad++/notepad++.exe"
```

Теперь встретив команду `notepad++`, Bash заменит её на абсолютный путь до исполняемого файла редактора.

У псевдонима есть одна проблема. Его надо объявлять каждый раз после запуска терминала MSYS2. Чтобы это происходило автоматически, добавьте объявление псевдонима в конец файла `~/.bashrc`. Bash исполняет все команды из этого файла при каждом запуске терминала.

После объявления псевдонима станет удобнее запускать Notepad++ из Bash. Вот пример команды, которая открывает в редакторе файл `test.txt`:
{line-numbers: false, format: Bash}
```
notepad++ test.txt
```

Если файла `test.txt` не существует, редактор предложит его создать.

### Фоновый режим

Предположим, что вы запустили графическое приложение из терминала. После этого терминал перестанет принимать ваши команды. Его контролирует запущенное приложение. Оно выводит в терминал свои сообщения. Терминал заработает в обычном режиме только после завершения приложения.

Графическое приложение можно запустить в **фоновом режиме** (background). Тогда окно терминала останется активным.

Чтобы запустить программу в фоновом режиме, добавьте амперсанд & в конец команды. Например, так:
{line-numbers: false, format: Bash}
```
notepad++ test.txt &
```

Эта команда откроет файл `test.txt` в редакторе. Notepad++ по-прежнему будет выводить свои сообщения в терминал. При этом терминал будет принимать и выполнять ваши команды. Такой режим ввода команд неудобен.

Вы можете полностью отделить графическое приложение от терминала. Для этого вызовите Bash-команду disown с опцией `-a` следующим образом:
{line-numbers: false, format: Bash}
```
notepad++ test.txt &
disown -a
```

Теперь редактор не выводит свои сообщения в терминал. Кроме этого команда disown позволит Notepad++ работать, если вы закроете окно терминала. Без вызова disown редактор закроется вместе с терминалом.

Команды запуска Notepad++ и disown можно объединить в одну. Например, так:
{line-numbers: false, format: Bash}
```
notepad++ test.txt & disown -a
```

Параметр `-a` команды disown отделяет все приложения запущенные в фоновом режиме.

Предположим вам нужно отделить от терминала не все приложения, а только одно. Для этого вы должны знать [**идентификатор процесса**](https://ru.wikipedia.org/wiki/Идентификатор_процесса) (PID) этого приложения. Идентификатор процесса — это уникальный номер, который ОС назначает процессу каждой запущенной программы.

Когда вы запускаете приложение в фоновом режиме, Bash выводит идентификатор его процесса. Вот пример такого вывода:
{line-numbers: false, format: Bash}
```
notepad++ test.txt &
[1] 600
```

Вторая строка содержит два числа. Второе число 600 — это PID. Первое число `[1]` — это идентификатор задачи (job ID). Идентификатор задачи нужен, чтобы перевести приложение из фонового режима в обычный. Это делает Bash-команда fg. Вот пример её вызова для нашего случая:
{line-numbers: false, format: Bash}
```
fg %1
```

Чтобы отделить процесс Notepad++ от терминала, вызовите команду disown так:
{line-numbers: false, format: Bash}
```
disown 600
```

Вы можете вывести список всех приложений, запущенных в фоновом режиме. Это делает Bash-команда jobs. Передайте ей опцию `-l`, чтобы получить идентификаторы задачи и процесса для каждого запущенного приложения. Вот пример вызова jobs:
{line-numbers: false, format: Bash}
```
jobs -l
```

Можно запустить редактор Notepad++ и отделить только его от терминала одной командой. Для этого вам понадобится переменная Bash с именем `$!`. Она хранит PID последней выполненной команды. Передайте этот PID в disown следующим образом:
{line-numbers: false, format: Bash}
```
notepad++ test.txt & disown $!
```